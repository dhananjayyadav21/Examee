<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examee</title>
    <link rel="icon" type="image/x-icon" href="img/brandlog.png">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/nav.css">
    <script src="js/login.js"></script>
</head>

<body>

    <!--nav baar -->
    <nav>
        <div class="leftnav">
            <a href="/">
                <li><img class="brand-logo-group" src="img/brandlog.png" class="logo" width="110px" height="30px"></li>
            </a>
        </div>

        <div class="menunav"> <a href="#">
                <li onclick=showSidebar()><img src="img/icons8-menu-24.png"></li>
            </a>
        </div>

        <!-- sidebaar -->
        <div class="sidebar">
            <a href="#">
                <li onclick=closeSidebar()><img src="img/icons8-cross-30.png"></li>
            </a>
            <a href="#">
                <li><img class="sidebaar-tital-img" src="img/category.png" width="25px" height="25px"><select
                        class="select-option-group" name="degree" id="">
                        <option value="0" hidden>Category</option>
                        <option value="BSC-IT">BSC-IT</option>
                        <option value="MSC-IT">MSC-IT</option>
                        <option value="B.COM">B.COM</option>
                        <option value="12TH-SCIENCE">12TH-SCIENCE</option>
                        <option value="12TH-COMMERCE">12TH-COMMERCE</option>
                    </select></li>
            </a>
            <a href="/notes.html">
                <li><img class="sidebaar-tital-img" src="img/icons8-notes-50.png" width="15px" height="15px">Notes</li>
            </a>
            <a href="/practical.html">
                <li><img class="sidebaar-tital-img" src="img/icons8-computer-30.png" width="15px"
                        height="15px">Practical </li>
            </a>
            <a href="/Qution-Paper.html">
                <li><img class="sidebaar-tital-img" src="img/corrective_11907117.png" width="15px"
                        height="15px">Qution-Paper
                </li>
            </a>
            <a href="/cource.html">
                <li><img class="sidebaar-tital-img" src="img/icons8-course-80.png" width="15px" height="15px">Cources
                </li>
            </a>
            <a href="/video.html">
                <li><img class="sidebaar-tital-img" src="img/icons8-video-50.png" width="15px" height="15px">Video</li>
            </a>
        </div>

    </nav>

    <!--login form-->
    <form action="" id="forgetForm" novalidate>
        <div class="container">
            <div class="loginpage">
                <h2 class="page-heading">FORGOT PASSWORD</h2>

                <div class="username form-input-group">
                    <label class="input-label">E-mail address</label><br>
                    <input class="form-input" type="email" placeholder="Enter email address" id="email" required>
                </div>

                <div class="sumbit form-input-group">
                    <button class="btn" type="submit" id="otp-request-btn">Get Verification Code</button>
                </div>

                <div class="username form-input-group">
                    <label class="input-label">Verification Code</label><br>
                    <input class="form-input" type="text" placeholder="Verification Code" id="otp" required>
                </div>

                <div class="Password form-input-group">
                    <label class="input-label">New Password</label><br>
                    <input class="form-input" type="password" placeholder="Password" id="password" required>
                </div>

                <div class="Password form-input-group">
                    <label class="input-label">Confirm Password</label><br>
                    <input class="form-input" type="text" placeholder="Confirm Password" id="cpassword" required>
                </div>

                <div class="sumbit form-input-group">
                    <button class="btn" type="submit" id="login-sumbit-btn">Change Password</button>
                </div>

                <div class="form-register-group">
                    <p>Already have an account? </p>
                    <a class="form-register-second-group" href="/login.html">Sign In</a>
                  </div>
            </div>
        </div>
    </form>

    <script>

        let baseUrl = 'https://script.google.com/macros/s/AKfycbybtynNQqtfRysRiyKEo02bHRNqR_WQOuK0gZNWwA129d2eaNcXGy77qIPgvkcY7jYS4w/exec';

        function showSidebar() {
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'flex'
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'none'
        }


        //login form js---------------------------------------------
        let forgetForm = document.getElementById('forgetForm')

        forgetForm.addEventListener("submit", (e) => {
            debugger
            e.preventDefault()
            let email = document.getElementById("email").value;
            let password = document.getElementById("password").value;

            let cpassword = document.getElementById("cpassword").value;

            let otp = document.getElementById("otp").value;


            forgotPassword(email, password,otp);


        });

        let requestOtpBtn = document.getElementById('otp-request-btn');

        requestOtpBtn.addEventListener("click", async (e) => {
            e.preventDefault()
            let email = document.getElementById("email").value;
            
            if (email!=null && email.trim().toLowerCase()!="") {
                await requestOtp(email);
            }
        });

        async function requestOtp(email) {
            let url = baseUrl;
            const params = new URLSearchParams({
                action: 'requestOtp',
                email: email
            });
            url = url + '?' + params.toString();
            try {
                const response = await fetch(url);
                const userRes = await response.json();
                if (userRes != null) {
                    if (userRes.code == 200) {
                        alert(userRes.message);
                    } else {
                        alert(userRes.error)
                    }
                }

            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function forgotPassword(email, password,otp) {
            let url = baseUrl;
            const params = new URLSearchParams({
                action: 'forgotPassword',
                email: email,
                password: password,
                otp:otp
            });
            url = url + '?' + params.toString();
            try {
                const response = await fetch(url);
                const userRes = await response.json();
                console.log('Add User Response:', userRes);

                if (userRes != null) {
                    if (userRes.code == 200) {
                        alert(userRes.message);
                        window.location.replace("/login.html")
                    } else {
                        alert(userRes.error)
                    }
                }

            } catch (error) {
                console.error('Error:', error);
            }
        }

    </script>
    <script src="js/script.js"></script>

</body>

</html>